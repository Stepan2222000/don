# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ Telegram

**–î–∞—Ç–∞:** 2024-11-15
**–ü—Ä–æ–µ–∫—Ç:** Telegram Automation System
**–ü–∞–ø–∫–∞:** `/Users/stepanorlov/Desktop/donat/tg-automatizamtion/`

---

## üéØ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ü–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram-—á–∞—Ç—ã —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `web.telegram.org/k`, –∏—Å–ø–æ–ª—å–∑—É—è –±—Ä–∞—É–∑–µ—Ä–Ω—É—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é (Playwright + Camoufox) –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ Donut Browser.

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

- **–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:** `/Users/stepanorlov/Desktop/donat/tg-automatizamtion/`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite (–æ–¥–∏–Ω —Ñ–∞–π–ª –ë–î –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ `~/Library/Application Support/DonutBrowserDev/profiles/`
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** CLI (command line interface)
- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** Python
- **–ë—Ä–∞—É–∑–µ—Ä:** Camoufox —á–µ—Ä–µ–∑ Playwright
- **Telegram –≤–µ—Ä—Å–∏—è:** web.telegram.org/k

### 2. –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã

- **Headless:** `false` (–≤–∏–¥–∏–º—ã–µ –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –î–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–∞—è (–±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

---

## üèóÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ñ–∏–ª–µ–π

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –º–æ–¥–µ–ª–∏ **Worker Pool**:

```
Main Process (CLI)
    ‚îú‚îÄ‚îÄ Worker Process 1 (Profile A) ‚Üí Browser Instance A ‚Üí Telegram
    ‚îú‚îÄ‚îÄ Worker Process 2 (Profile B) ‚Üí Browser Instance B ‚Üí Telegram
    ‚îú‚îÄ‚îÄ Worker Process 3 (Profile C) ‚Üí Browser Instance C ‚Üí Telegram
    ‚îî‚îÄ‚îÄ ...
                ‚Üì
        Shared SQLite Database (WAL mode)
                ‚Üì
          Common Task Queue
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

1. **–ü—É–ª –ø—Ä–æ—Ñ–∏–ª–µ–π:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ Donut Browser –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ä–∞—Å—Å—ã–ª–∫–µ
   - –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –≤–æ—Ä–∫–µ—Ä (worker process)
   - –í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–∏–º–∏—Ç—ã, –∑–∞–¥–µ—Ä–∂–∫–∏)

2. **–û–±—â–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á:**
   - –í—Å–µ –∑–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite –ë–î
   - –í–æ—Ä–∫–µ—Ä—ã –±–µ—Ä—É—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏ (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
   - –ö—Ç–æ –ø–µ—Ä–≤—ã–π –≤–∑—è–ª –∑–∞–¥–∞—á—É - —Ç–æ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

3. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:**
   - –ó–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤–æ–µ–º —Ç–µ–º–ø–µ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–∏–º–∏—Ç–æ–≤)

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```
–í—Ä–µ–º—è | –ü—Ä–æ—Ñ–∏–ª—å A              | –ü—Ä–æ—Ñ–∏–ª—å B              | –ü—Ä–æ—Ñ–∏–ª—å C
------|------------------------|------------------------|------------------------
12:00 | –ë–µ—Ä–µ—Ç @chat1           | –ë–µ—Ä–µ—Ç @chat2           | –ë–µ—Ä–µ—Ç @chat3
12:01 | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ   | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ   | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
12:03 | –û–∂–∏–¥–∞–Ω–∏–µ (delay)       | –û–∂–∏–¥–∞–Ω–∏–µ (delay)       | –û–∂–∏–¥–∞–Ω–∏–µ (delay)
12:05 | –ë–µ—Ä–µ—Ç @chat4           | –ë–µ—Ä–µ—Ç @chat5           | –ë–µ—Ä–µ—Ç @chat6
...
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite

### –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–§–∞–π–ª:** `db/telegram_automation.db`
- **–†–µ–∂–∏–º:** WAL (Write-Ahead Logging) –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** UTF-8

### –°—Ö–µ–º–∞ –ë–î (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

#### –¢–∞–±–ª–∏—Ü–∞: `profiles`

–ü—Ä–æ—Ñ–∏–ª–∏ Donut Browser, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ.

```sql
CREATE TABLE profiles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    profile_id TEXT UNIQUE NOT NULL,           -- UUID –ø—Ä–æ—Ñ–∏–ª—è Donut Browser
    profile_name TEXT NOT NULL,                -- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    is_active BOOLEAN DEFAULT 1,               -- –£—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ
    is_blocked BOOLEAN DEFAULT 0,              -- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ Telegram –≤ –ø—Ä–æ—Ñ–∏–ª–µ
    messages_sent_current_hour INTEGER DEFAULT 0,
    hour_reset_time TIMESTAMP,                 -- –í—Ä–µ–º—è —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞
    last_message_time TIMESTAMP,               -- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `tasks`

**–í–ê–ñ–ù–û:** –ó–∞–¥–∞—á–∞ = —Ä–∞–±–æ—Ç–∞ —Å –æ–¥–Ω–∏–º —á–∞—Ç–æ–º (–æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ —á–∞—Ç).
–ó–∞–¥–∞—á–∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –ø–æ–ø—ã—Ç–∫–∞–º –æ—Ç–ø—Ä–∞–≤–∫–∏.

```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chat_username TEXT UNIQUE NOT NULL,        -- @username —á–∞—Ç–∞
    status TEXT DEFAULT 'pending',             -- pending/in_progress/completed/blocked
    assigned_profile_id TEXT,                  -- –¢–µ–∫—É—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (NULL –µ—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω–∞)

    -- –ü—Ä–æ–≥—Ä–µ—Å—Å
    total_cycles INTEGER DEFAULT 1,            -- –°–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤ –Ω—É–∂–Ω–æ (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    completed_cycles INTEGER DEFAULT 0,        -- –°–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    success_count INTEGER DEFAULT 0,           -- –£—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
    failed_count INTEGER DEFAULT 0,            -- –ù–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

    -- –§–ª–∞–≥–∏
    is_blocked BOOLEAN DEFAULT 0,              -- –ù–∞–≤—Å–µ–≥–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
    block_reason TEXT,                         -- –ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

    -- –í—Ä–µ–º–µ–Ω–∞
    last_attempt_at TIMESTAMP,                 -- –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞
    next_available_at TIMESTAMP,               -- –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ (–¥–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_next_available ON tasks(next_available_at);
CREATE INDEX idx_tasks_is_blocked ON tasks(is_blocked);
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
| chat_username | status      | total_cycles | completed_cycles | success | failed |
|---------------|-------------|--------------|------------------|---------|--------|
| @chat1        | completed   | 3            | 3                | 3       | 0      |
| @chat2        | in_progress | 3            | 2                | 2       | 0      |
| @chat3        | pending     | 3            | 1                | 0       | 1      |
| @chat4        | blocked     | 3            | 0                | 0       | 1      |
```

#### –¢–∞–±–ª–∏—Ü–∞: `task_attempts`

–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏).

```sql
CREATE TABLE task_attempts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id INTEGER NOT NULL,                  -- FK -> tasks.id
    profile_id TEXT NOT NULL,                  -- –ö—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª
    cycle_number INTEGER NOT NULL,             -- –ù–æ–º–µ—Ä —Ü–∏–∫–ª–∞ (1, 2, 3...)
    status TEXT NOT NULL,                      -- success/failed
    message_text TEXT,                         -- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    error_type TEXT,                           -- chat_not_found/send_error/blocked/etc
    error_message TEXT,                        -- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE
);

CREATE INDEX idx_attempts_task_id ON task_attempts(task_id);
CREATE INDEX idx_attempts_status ON task_attempts(status);
CREATE INDEX idx_attempts_timestamp ON task_attempts(timestamp);
```

#### –¢–∞–±–ª–∏—Ü–∞: `messages`

–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏.

```sql
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    text TEXT NOT NULL,                        -- –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    is_active BOOLEAN DEFAULT 1,               -- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ
    usage_count INTEGER DEFAULT 0,             -- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `send_log`

–û–±—â–∏–π –ª–æ–≥ –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏).

```sql
CREATE TABLE send_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id INTEGER,                           -- FK -> tasks.id (NULL –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞)
    profile_id TEXT NOT NULL,
    chat_username TEXT NOT NULL,
    message_text TEXT,
    status TEXT NOT NULL,                      -- success/failed
    error_type TEXT,                           -- chat_not_found/send_error/blocked/etc
    error_details TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE SET NULL
);

CREATE INDEX idx_send_log_status ON send_log(status);
CREATE INDEX idx_send_log_timestamp ON send_log(timestamp);
CREATE INDEX idx_send_log_chat ON send_log(chat_username);
```

#### –¢–∞–±–ª–∏—Ü–∞: `screenshots`

–°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

```sql
CREATE TABLE screenshots (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    log_id INTEGER,                            -- FK -> send_log.id (NULL –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö)
    screenshot_type TEXT NOT NULL,             -- error/warning/debug
    file_name TEXT NOT NULL,                   -- –ò–º—è —Ñ–∞–π–ª–∞
    description TEXT,                          -- –û–ø–∏—Å–∞–Ω–∏–µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (log_id) REFERENCES send_log(id) ON DELETE CASCADE
);

CREATE INDEX idx_screenshots_log_id ON screenshots(log_id);
CREATE INDEX idx_screenshots_type ON screenshots(screenshot_type);
CREATE INDEX idx_screenshots_created ON screenshots(created_at);
```

**–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è:** `logs/screenshots/{screenshot_type}/{file_name}`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-automatizamtion/
‚îú‚îÄ‚îÄ README.md                          # –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt                   # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ config.yaml                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example                       # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql                     # SQL —Å—Ö–µ–º–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞ –±—É–¥—É—â–µ–µ)
‚îÇ   ‚îî‚îÄ‚îÄ telegram_automation.db         # SQLite –±–∞–∑–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                        # CLI entry point
‚îÇ   ‚îú‚îÄ‚îÄ config.py                      # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ database.py                    # –†–∞–±–æ—Ç–∞ —Å SQLite
‚îÇ   ‚îú‚îÄ‚îÄ profile_manager.py             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ Donut Browser
‚îÇ   ‚îú‚îÄ‚îÄ browser_automation.py          # Playwright –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ telegram_sender.py             # –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ task_queue.py                  # –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ worker.py                      # –í–æ—Ä–∫–µ—Ä –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ error_handler.py               # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ logger.py                      # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ chats.txt                      # –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (@username –ø–æ —Å—Ç—Ä–æ–∫–µ)
‚îÇ   ‚îî‚îÄ‚îÄ messages.json                  # –ú–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ logs/                              # –õ–æ–≥–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ main.log
‚îÇ   ‚îú‚îÄ‚îÄ success.log
‚îÇ   ‚îú‚îÄ‚îÄ failed_chats.log
‚îÇ   ‚îú‚îÄ‚îÄ failed_send.log
‚îÇ   ‚îî‚îÄ‚îÄ screenshots/                   # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –æ—à–∏–±–æ–∫
‚îÇ       ‚îú‚îÄ‚îÄ errors/                    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ warnings/                  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ debug/                     # –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ
‚îÇ
‚îú‚îÄ‚îÄ htmls/                             # HTML –ø—Ä–∏–º–µ—Ä—ã (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ main.html
‚îÇ   ‚îú‚îÄ‚îÄ search.html
‚îÇ   ‚îî‚îÄ‚îÄ chat.html
‚îÇ
‚îî‚îÄ‚îÄ docs/                              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ REQUIREMENTS.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îú‚îÄ‚îÄ SELECTORS.md                   # –°–µ–ª–µ–∫—Ç–æ—Ä—ã Telegram Web
    ‚îî‚îÄ‚îÄ ARCHITECTURE.md                # –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (TODO)
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª: `config.yaml`

```yaml
# –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
limits:
  max_messages_per_hour: 30            # –°–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
  max_cycles: 1                        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤ (–ø—Ä–æ—Ö–æ–¥–æ–≤ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º)
  delay_randomness: 0.2                # ¬±20% –∫ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ
  cycle_delay_minutes: 20              # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ (–º–∏–Ω—É—Ç—ã)

# –¢–∞–π–º–∞—É—Ç—ã
timeouts:
  search_timeout: 10                   # –¢–∞–π–º–∞—É—Ç –ø–æ–∏—Å–∫–∞ —á–∞—Ç–∞ (—Å–µ–∫—É–Ω–¥—ã)
  send_timeout: 5                      # –¢–∞–π–º–∞—É—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
  page_load_timeout: 30                # –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

# Telegram
telegram:
  url: "https://web.telegram.org/k"
  headless: false                      # –í–∏–¥–∏–º—ã–µ –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
retry:
  enabled: false                       # –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ª–∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
  max_attempts: 3                      # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫
  delay_between_retries: 60            # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)

# –°–∫—Ä–∏–Ω—à–æ—Ç—ã
screenshots:
  enabled: true                        # –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
  on_error: true                       # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  on_warning: false                    # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö (—á–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω)
  on_debug: false                      # –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
  full_page: true                      # –°–∫—Ä–∏–Ω—à–æ—Ç –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  quality: 80                          # –ö–∞—á–µ—Å—Ç–≤–æ (0-100)
  format: "png"                        # png/jpeg
  max_age_days: 30                     # –£–¥–∞–ª—è—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging:
  level: "INFO"                        # DEBUG/INFO/WARNING/ERROR
  format: "%(asctime)s | %(name)s | %(levelname)s | %(message)s"

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
database:
  path: "db/telegram_automation.db"
  wal_mode: true                       # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WAL —Ä–µ–∂–∏–º
```

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ `config.yaml`
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
3. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ –∏–∑ `data/chats.txt`
4. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `data/messages.json`
5. –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
6. –í—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
browser = open_browser_with_profile(profile_id)
navigate_to_telegram(browser)

while True:
    # 1. –í–∑—è—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –ë–î (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
    # –ë–µ—Ä–µ–º –∑–∞–¥–∞—á—É –≥–¥–µ completed_cycles < total_cycles
    task = get_next_incomplete_task(profile_id)

    if task is None:
        # –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á
        logger.info("No more tasks available")
        break

    # 2. –ó–∞–¥–∞—á–∞ –≤–∑—è—Ç–∞, —Å—Ç–∞—Ç—É—Å = 'in_progress', assigned_profile_id = profile_id

    try:
        # 3. –ù–∞–π—Ç–∏ —á–∞—Ç
        chat_found = search_chat(browser, task.chat_username)

        if not chat_found:
            # –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
            handle_chat_not_found(task, profile_id)
            # –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—É—é
            block_task(task.id, reason="chat_not_found")
            continue

        # 4. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
        open_chat(browser, task.chat_username)

        # 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
        restrictions = check_chat_restrictions(browser)

        if restrictions['account_frozen']:
            # –ê–∫–∫–∞—É–Ω—Ç –∑–∞–º–æ—Ä–æ–∂–µ–Ω - –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            block_profile(profile_id)
            logger.error(f"Profile {profile_id} is frozen by Telegram")
            save_screenshot(browser, 'error', 'account_frozen')
            break  # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞, –≤–æ—Ä–∫–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

        if not restrictions['can_send']:
            # –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É (–Ω—É–∂–Ω–æ –≤—Å—Ç—É–ø–∏—Ç—å, –Ω—É–∂–µ–Ω Premium, –∏ —Ç.–¥.)
            handle_send_restriction(task, profile_id, restrictions['reason'])
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ø—ã—Ç–∫—É –∫–∞–∫ failed
            add_task_attempt(
                task_id=task.id,
                profile_id=profile_id,
                cycle_number=task.completed_cycles + 1,
                status='failed',
                error_type=restrictions['reason']
            )
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á
            increment_task_failed_count(task.id)
            increment_completed_cycles(task.id)
            continue

        # 6. –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        message = get_random_message()

        # 7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        send_message(browser, message)

        # 8. –ó–∞–ø–∏—Å–∞—Ç—å —É—Å–ø–µ—à–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
        add_task_attempt(
            task_id=task.id,
            profile_id=profile_id,
            cycle_number=task.completed_cycles + 1,
            status='success',
            message_text=message
        )

        # 9. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–¥–∞—á–∏
        increment_task_success_count(task.id)
        increment_completed_cycles(task.id)

        # 10. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—Ö
        log_success(profile_id, task.chat_username, message)

        # 11. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞
        if task.completed_cycles + 1 >= task.total_cycles:
            mark_task_completed(task.id)
            logger.info(f"Task {task.chat_username} completed")
        else:
            # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å next_available_at –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏
            set_task_next_available(task.id, delay_seconds)

        # 12. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É
        delay = calculate_delay(
            max_messages_per_hour=config.max_messages_per_hour,
            randomness=config.delay_randomness
        )

        # 13. –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
        update_profile_stats(profile_id)

        # 14. –ü–æ–¥–æ–∂–¥–∞—Ç—å
        logger.info(f"Waiting {delay} seconds...")
        sleep(delay)

    except Exception as e:
        # –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
        logger.error(f"Unexpected error: {e}")

        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç
        save_screenshot(browser, 'error', f'unexpected_error_{task.chat_username}')

        # –ó–∞–ø–∏—Å–∞—Ç—å –Ω–µ—É–¥–∞—á–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
        add_task_attempt(
            task_id=task.id,
            profile_id=profile_id,
            cycle_number=task.completed_cycles + 1,
            status='failed',
            error_type='exception',
            error_message=str(e)
        )

        # –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á
        increment_task_failed_count(task.id)
        increment_completed_cycles(task.id)

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞
close_browser(browser)
logger.info(f"Worker {profile_id} finished")
```

### –§—É–Ω–∫—Ü–∏—è –≤–∑—è—Ç–∏—è –∑–∞–¥–∞—á–∏ (–∞—Ç–æ–º–∞—Ä–Ω–∞—è)

```python
def get_next_incomplete_task(profile_id: str):
    """
    –ê—Ç–æ–º–∞—Ä–Ω–æ –≤–∑—è—Ç—å —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É
    """
    with db.transaction():
        # UPDATE + RETURNING –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
        task = db.execute("""
            UPDATE tasks
            SET
                status = 'in_progress',
                assigned_profile_id = :profile_id,
                updated_at = CURRENT_TIMESTAMP
            WHERE id = (
                SELECT id FROM tasks
                WHERE
                    is_blocked = 0
                    AND completed_cycles < total_cycles
                    AND (next_available_at IS NULL OR next_available_at <= CURRENT_TIMESTAMP)
                    AND (status = 'pending' OR (status = 'in_progress' AND assigned_profile_id = :profile_id))
                ORDER BY
                    last_attempt_at ASC NULLS FIRST,  -- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–µ–º, —á—Ç–æ –¥–∞–≤–Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                    completed_cycles ASC               -- –ó–∞—Ç–µ–º —Ç–µ–º, —É –∫–æ–≥–æ –º–µ–Ω—å—à–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                LIMIT 1
            )
            RETURNING *
        """, profile_id=profile_id).fetchone()

        return task
```

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

- Graceful shutdown –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ (Ctrl+C)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ë–î
- –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

---

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°–ª—É—á–∞–π 1: –ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- –ü—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è "No results"
- –≠–ª–µ–º–µ–Ω—Ç `.chatlist` –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ `.chatlist-chat`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `failed_chats.log`:
   ```
   2024-11-15 12:57:46 | Profile: profile_name | Chat: @nonexistent | Error: Chat not found
   ```
3. –ó–∞–ø–∏—Å–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É –≤ `task_attempts`:
   ```sql
   INSERT INTO task_attempts (task_id, profile_id, cycle_number, status, error_type)
   VALUES (task_id, profile_id, cycle + 1, 'failed', 'chat_not_found')
   ```
4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É:
   - `tasks.is_blocked = true`
   - `tasks.block_reason = 'chat_not_found'`
   - `tasks.status = 'blocked'`
   - `tasks.failed_count += 1`
5. –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ (—ç—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –≤–æ—Ä–∫–µ—Ä–∞–º–∏)

### –°–ª—É—á–∞–π 2: –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Telegram

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- –°–æ–æ–±—â–µ–Ω–∏–µ "Your Account is Frozen" (`.chat-input-frozen-text`)
- –î—Ä—É–≥–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `main.log`:
   ```
   2024-11-15 12:57:46 | ERROR | Profile profile_name is blocked by Telegram
   ```
3. –û–±–Ω–æ–≤–∏—Ç—å –≤ –ë–î:
   - `profiles.is_blocked = true`
   - `profiles.is_active = false`
4. –ó–∞–ø–∏—Å–∞—Ç—å –≤ `send_log` —Å `error_type = 'account_frozen'`
5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç –≤–æ—Ä–∫–µ—Ä (break –∏–∑ —Ü–∏–∫–ª–∞)
6. –î—Ä—É–≥–∏–µ –≤–æ—Ä–∫–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É

### –°–ª—É—á–∞–π 3: –ù–µ—Ç –ø—Ä–∞–≤ –ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- –ö–Ω–æ–ø–∫–∞ "JOIN" –≤–∏–¥–∏–º–∞ (`.chat-input-control-button` —Å —Ç–µ–∫—Å—Ç–æ–º "JOIN")
- –°–æ–æ–±—â–µ–Ω–∏–µ "Only Premium users can message..."
- –ö–Ω–æ–ø–∫–∞ "Unblock"

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç (warning level)
2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `failed_send.log`:
   ```
   2024-11-15 12:57:46 | Profile: profile_name | Chat: @premium_only | Error: Cannot send (need to join/premium required)
   ```
3. –ó–∞–ø–∏—Å–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É –≤ `task_attempts`:
   - `status = 'failed'`
   - `error_type` = 'need_to_join' / 'premium_required' / 'user_blocked'
4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É:
   - `tasks.failed_count += 1`
   - `tasks.completed_cycles += 1`
5. –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª ‚Üí `tasks.status = 'completed'`
6. –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ

### –°–ª—É—á–∞–π 4: –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- Timeout –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è
- Playwright –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
2. Retry (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
3. –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ failed
4. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É

---

## üìä –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

**main.log** (–æ–±—â–∏–π –ª–æ–≥):
```
2024-11-15 12:57:46 | INFO | Application started
2024-11-15 12:57:47 | INFO | Loaded 5 profiles
2024-11-15 12:57:48 | INFO | Worker started: profile_name (profile_id)
2024-11-15 12:58:00 | ERROR | Worker profile_name failed: Connection timeout
```

**success.log** (—É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏):
```
2024-11-15 12:57:46 | Profile: profile_name | Chat: @vibedevs | Message: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
```

**failed_chats.log** (–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–∞—Ç—ã):
```
2024-11-15 12:57:46 | Profile: profile_name | Chat: @nonexistent | Error: Chat not found
```

**failed_send.log** (–æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏):
```
2024-11-15 12:57:46 | Profile: profile_name | Chat: @somechat | Error: Cannot send - need to join
```

---

## üéÆ CLI –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ö–æ–º–∞–Ω–¥—ã (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ)

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
python -m src.main init

# –ò–º–ø–æ—Ä—Ç —á–∞—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞
python -m src.main import-chats data/chats.txt

# –ò–º–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ñ–∞–π–ª–∞
python -m src.main import-messages data/messages.json

# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
python -m src.main add-profile <profile_id>

# –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
python -m src.main list-profiles

# –ó–∞–ø—É—Å–∫ —Ä–∞—Å—Å—ã–ª–∫–∏ (N –≤–æ—Ä–∫–µ—Ä–æ–≤)
python -m src.main start --workers 3

# –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
python -m src.main status

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤–æ—Ä–∫–µ—Ä—ã
python -m src.main stop
```

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### 1. –õ–æ–≥–∏–∫–∞ —Ü–∏–∫–ª–æ–≤

**–¶–∏–∫–ª = –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º**

–ï—Å–ª–∏ `max_cycles = 3` –∏ 100 —á–∞—Ç–æ–≤:
```
–¶–∏–∫–ª 1: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ –≤—Å–µ 100 —á–∞—Ç–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç 1 —Å–æ–æ–±—â–µ–Ω–∏–µ)
  ‚îî‚îÄ –ó–∞–¥–µ—Ä–∂–∫–∞ 20 –º–∏–Ω—É—Ç
–¶–∏–∫–ª 2: –°–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ –≤—Å–µ 100 —á–∞—Ç–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç –µ—â–µ 1 —Å–æ–æ–±—â–µ–Ω–∏–µ)
  ‚îî‚îÄ –ó–∞–¥–µ—Ä–∂–∫–∞ 20 –º–∏–Ω—É—Ç
–¶–∏–∫–ª 3: –°–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ –≤—Å–µ 100 —á–∞—Ç–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç –µ—â–µ 1 —Å–æ–æ–±—â–µ–Ω–∏–µ)
  ‚îî‚îÄ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

**–ò—Ç–æ–≥–æ:** –ö–∞–∂–¥—ã–π —á–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç `max_cycles` —Å–æ–æ–±—â–µ–Ω–∏–π.

**–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏:** 20 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

### 2. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–æ–∫

**–î–≤–æ–π–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (A + B –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ):**

1. **–ü–æ —á–∞—Ç–∞–º (A):** –í –∫–∞–∂–¥—ã–π —á–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–µ—Ç—Å—è —á–∞—Ç–∞–º —Å –º–µ–Ω—å—à–∏–º `completed_cycles`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —á–∞—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ü–∏–∫–ª—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

2. **–ü–æ –ø—Ä–æ—Ñ–∏–ª—è–º (B):** –ú–µ–∂–¥—É –ø—Ä–æ—Ñ–∏–ª—è–º–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
   - –í–æ—Ä–∫–µ—Ä—ã –±–µ—Ä—É—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏
   - –ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ —á–∞—Ç–æ–≤ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è–º
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–æ—Ñ–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í SQL –∑–∞–ø—Ä–æ—Å–µ get_next_incomplete_task
ORDER BY
    completed_cycles ASC,        # –°–Ω–∞—á–∞–ª–∞ —Ç–µ, —É –∫–æ–≥–æ –º–µ–Ω—å—à–µ —Ü–∏–∫–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
    last_attempt_at ASC NULLS FIRST  # –ó–∞—Ç–µ–º –¥–∞–≤–Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
```

### 3. –í—ã–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä:**
```python
import random

def get_random_message():
    messages = db.get_active_messages()
    return random.choice(messages)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- @chat1 ‚Üí "–ü—Ä–∏–≤–µ—Ç!"
- @chat2 ‚Üí "–ü—Ä–∏–≤–µ—Ç!" (–º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è)
- @chat3 ‚Üí "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!"
- @chat4 ‚Üí "–ü—Ä–∏–≤–µ—Ç!" (–º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)

–ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è - –ø–æ–ª–Ω—ã–π —Ä–∞–Ω–¥–æ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑.

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π

**–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (—á–µ—Ä–µ–∑ nodecar):**

```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º launch_profile.py
from pathlib import Path
import subprocess
import sys

# –ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É launch_profile
LAUNCH_SCRIPT = Path(__file__).parent.parent / "comander" / "launch_profile.py"

def launch_profile(profile_id: str):
    """–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ nodecar"""
    process = subprocess.Popen(
        [sys.executable, str(LAUNCH_SCRIPT), "--profile-id", profile_id],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE
    )
    return process
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º nodecar
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ—Ñ–∏–ª–µ–π (–ø—Ä–æ–∫—Å–∏, fingerprint, –∏ —Ç.–¥.)

### 5. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram

**–ü—Ä–æ—Ñ–∏–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤—Ä—É—á–Ω—É—é.**

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω:
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ Donut Browser UI
2. –ó–∞–π—Ç–∏ –Ω–∞ web.telegram.org/k
3. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
4. –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å –≥–æ—Ç–æ–≤ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–µ.

### 6. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–ò—Å–ø–æ–ª—å–∑—É–µ–º asyncio + subprocess —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º:**

```python
import asyncio
import subprocess

class WorkerManager:
    def __init__(self, profile_ids):
        self.profile_ids = profile_ids
        self.workers = {}  # profile_id -> Process

    async def start_worker(self, profile_id):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è"""
        process = await asyncio.create_subprocess_exec(
            sys.executable, "-m", "src.worker",
            "--profile-id", profile_id,
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE
        )
        self.workers[profile_id] = process

        # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ—Ä–∫–µ—Ä–∞
        asyncio.create_task(self.monitor_worker(profile_id, process))

    async def monitor_worker(self, profile_id, process):
        """–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤–æ—Ä–∫–µ—Ä –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏"""
        returncode = await process.wait()

        if returncode != 0:
            logger.error(f"Worker {profile_id} crashed with code {returncode}")

            # –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
            await asyncio.sleep(5)

            # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä
            logger.info(f"Restarting worker {profile_id}...")
            await self.start_worker(profile_id)
        else:
            logger.info(f"Worker {profile_id} finished normally")

    async def start_all(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤"""
        tasks = [self.start_worker(pid) for pid in self.profile_ids]
        await asyncio.gather(*tasks)
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:** –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä = –æ—Ç–¥–µ–ª—å–Ω—ã–π subprocess
- ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** –ü–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- ‚úÖ **–ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:** –ï—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä —É–ø–∞–ª - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Main process —Å–ª–µ–¥–∏—Ç –∑–∞ –≤—Å–µ–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- ‚úÖ **Graceful shutdown:** Ctrl+C –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **Graceful shutdown:** –î–∞, –ø–æ Ctrl+C
2. **–ö–æ–º–∞–Ω–¥–∞ status:** –î–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
3. **–ê–≤—Ç–æ–æ—Å—Ç–∞–Ω–æ–≤–∫–∞:** –ù–µ—Ç, –≤–æ—Ä–∫–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–∫–∞ –µ—Å—Ç—å –∑–∞–¥–∞—á–∏ –∏–ª–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã**
2. **–§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –ë–î**
3. **–°–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** (ARCHITECTURE.md)
4. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å SQL —Å—Ö–µ–º—É** (db/schema.sql)
5. **–ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥—É–ª–µ–π**

---

**–°—Ç–∞—Ç—É—Å:** üéâ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 3.0 (FINAL)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-11-15

---

## üìå –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ)

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–¥–∞—á:** –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –Ω–∞ —á–∞—Ç, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≤—Å–µ–º —Ü–∏–∫–ª–∞–º
2. **–¶–∏–∫–ª—ã:** –¶–∏–∫–ª = –ø—Ä–æ—Ö–æ–¥ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º; –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ = 20 –º–∏–Ω—É—Ç
3. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:** –î–≤–æ–π–Ω–∞—è (–ø–æ —á–∞—Ç–∞–º + –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
4. **–í—ã–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª—É—á–∞–π–Ω—ã–π
5. **–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π:** –ß–µ—Ä–µ–∑ nodecar (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
6. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ü—Ä–æ—Ñ–∏–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤—Ä—É—á–Ω—É—é
7. **–ü—Ä–æ—Ü–µ—Å—Å—ã:** asyncio + subprocess —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º —É–ø–∞–≤—à–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
8. **–°–∫—Ä–∏–Ω—à–æ—Ç—ã:** –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `screenshots` —Å —Ç–∏–ø–∞–º–∏ (error/warning/debug)
9. **–ë–î:** SQLite –≤ WAL —Ä–µ–∂–∏–º–µ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
